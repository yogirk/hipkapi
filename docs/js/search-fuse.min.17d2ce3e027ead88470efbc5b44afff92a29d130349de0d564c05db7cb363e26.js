document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("fuse-search-input"),t=document.getElementById("fuse-search-results");let s=null;const a=e.dataset.baseUrl||"/",r=a+"index.json";e.disabled=!0,e.placeholder="Loading search...";const n=document.createElement("p");n.className="search-loading",n.textContent="Loading search index...",t.appendChild(n),fetch(r).then(e=>{if(!e.ok)throw new Error("HTTP "+e.status);return e.json()}).then(t=>{s=new Fuse(t,{keys:["title","content","tags","categories"],includeScore:!0,threshold:.3,minMatchCharLength:2}),n.parentNode&&n.parentNode.removeChild(n),e.disabled=!1,e.placeholder="Search for articles...";const o=new URLSearchParams(window.location.search).get("q");o&&(e.value=o,o.length>=2&&i(s.search(o))),e.focus()}).catch(n=>{o();const s=document.createElement("p");s.className="search-error",s.textContent="Search is currently unavailable. Please try again later.",t.appendChild(s),e.disabled=!0,e.placeholder="Search unavailable",console.error("Failed to load search index:",n)}),e.addEventListener("input",()=>{const n=e.value;if(n.length<2){o();return}if(!s){o();const e=document.createElement("p");e.className="search-loading",e.textContent="Still loading...",t.appendChild(e);return}const a=s.search(n);i(a)});function o(){for(;t.firstChild;)t.removeChild(t.firstChild)}function i(e){if(o(),e.length===0){const e=document.createElement("p");e.textContent="No results found.",t.appendChild(e);return}e.forEach(({item:e})=>{const n=document.createElement("article");n.className="result-item";const s=document.createElement("h3");s.className="result-title";const o=document.createElement("a");o.href=e.uri,o.textContent=e.title,s.appendChild(o);const i=document.createElement("p");i.className="result-snippet",i.textContent=e.content.substring(0,150)+"...",n.appendChild(s),n.appendChild(i),t.appendChild(n)})}})