<div class="widget widget-categories">
  <h3 class="widget-title">{{ i18n "categories" }}</h3>
  {{ if .Site.Taxonomies.categories }}
  {{ $all := .Site.Taxonomies.categories.ByCount }}
  {{ $limit := .Site.Params.sidebar.categoriesCount | default 15 }}
  {{ $total := len $all }}
  <ul class="categories-list">
    {{ range $i, $t := $all }}
    <li{{ if ge $i $limit }} class="categories-hidden"{{ end }}><a href="{{ .Page.RelPermalink }}">{{ .Page.Title }}</a><span class="widget-count">{{ .Count }}</span></li>
    {{ end }}
  </ul>
  {{ if gt $total $limit }}
  <button class="categories-toggle" aria-expanded="false">
    <span class="categories-toggle-text">Show all ({{ $total }})</span>
    <svg class="categories-toggle-icon" width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M2.5 4.5L6 8L9.5 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </button>
  <script>
  (function() {
    var btn = document.currentScript.previousElementSibling;
    var total = {{ $total }};
    btn.addEventListener('click', function() {
      var expanded = this.getAttribute('aria-expanded') === 'true';
      this.setAttribute('aria-expanded', expanded ? 'false' : 'true');
      this.querySelector('.categories-toggle-text').textContent = expanded ? 'Show all (' + total + ')' : 'Show fewer';
      this.closest('.widget-categories').classList.toggle('categories-expanded');
    });
  })();
  </script>
  <style>
  .widget-categories .categories-hidden {
    display: none !important;
  }
  .widget-categories.categories-expanded .categories-hidden {
    display: flex !important;
  }
  .categories-toggle {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    margin-top: var(--space-s, 0.5rem);
    padding: 0;
    background: none;
    border: none;
    color: var(--color-text-offset, #5f6368);
    cursor: pointer;
    font-family: var(--font-body);
    font-size: var(--text-sm);
    transition: color 0.15s ease;
  }
  .categories-toggle:hover {
    color: var(--color-primary, #1a73e8);
  }
  .categories-toggle-icon {
    transition: transform 0.2s ease;
  }
  .categories-toggle[aria-expanded="true"] .categories-toggle-icon {
    transform: rotate(180deg);
  }
  </style>
  {{ end }}
  {{ end }}
</div>
